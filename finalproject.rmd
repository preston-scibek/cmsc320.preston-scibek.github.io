---
title: "Final Project"
author: "Preston Scibek"
date: "May 13, 2018"
output: html_document
---


## Intro
url_pitching = https://baseballsavant.mlb.com/statcast_search?hfPT=&hfAB=&hfBBT=&hfPR=&hfZ=&stadium=&hfBBL=&hfNewZones=&hfGT=R%7C&hfC=&hfSea=2018%7C&hfSit=&player_type=pitcher&hfOuts=&opponent=&pitcher_throws=&batter_stands=&hfSA=&game_date_gt=&game_date_lt=&team=BOS&position=&hfRO=&home_road=&hfFlag=&metric_1=&hfInn=&min_pitches=0&min_results=0&group_by=name&sort_col=pitches&player_event_sort=h_launch_speed&sort_order=desc&min_abs=0#results

url_batting = https://baseballsavant.mlb.com/statcast_search?hfPT=&hfAB=&hfBBT=&hfPR=&hfZ=&stadium=&hfBBL=&hfNewZones=&hfGT=R%7C&hfC=&hfSea=2018%7C&hfSit=&player_type=batter&hfOuts=&opponent=&pitcher_throws=&batter_stands=&hfSA=&game_date_gt=&game_date_lt=&team=BOS&position=&hfRO=&home_road=&hfFlag=&metric_1=&hfInn=&min_pitches=0&min_results=0&group_by=name&sort_col=pitches&player_event_sort=h_launch_speed&sort_order=desc&min_abs=0#results

This data comes from the mlb statcast dataset. The data can be found at the above urls by clicking on the icon above the graphs column in the table. Then load the data as shown below.

```{r setup, include=TRUE}
library(tidyverse)
library(stringr)
library(rvest)
library(ggplot2)
library(plotly)


final_pitching_data_table <- read_csv("redsox_pitching_5132018.csv")
final_batting_data_table <- read_csv("redsox_batting_5132018.csv")

head(final_pitching_data_table)

head(final_batting_data_table)
```


## Create ID Tables
If we look at the pitching and batting data we will notice that there are fields with ids that are not translated to names. So we will use the batting and pitching data to generate ids for each person. Since the player_name is the name of the batter/pitcher in their respective data sets we should be able to get all the ids by extracting the player_name with the batter field for the batting table and the player_name field with the pitcher field for the pitching data.

```{r get id table, include=TRUE}
batter_id_table <- final_batting_data_table %>%
  group_by(player_name, batter) %>%
  select(player_name, batter) %>%
  distinct

pitcher_id_table <- final_pitching_data_table %>%
  group_by(player_name, pitcher) %>%
  select(player_name, pitcher) %>%
  distinct

head(batter_id_table)

head(pitcher_id_table)
```

## Get Mookie Betts Data
Mookie Betts is having a standout season. I would like to focus on data regarding Mookie's at bats.

```{r get mookie data}
mookie_data <- final_batting_data_table %>%
  filter(player_name=="Mookie Betts")

mookie_data

```

## Events
```{r mookie at bat events}
mookie_data <- mookie_data %>%
  mutate(rbi=post_bat_score-bat_score)
  
mookie_data %>%
  group_by(events) %>%
  summarize(count=n())
```
Lets look at the at bats but grouped based on pitch type.
```{r at bat pitch type}
mookie_data %>%
  group_by(events, pitch_name) %>%
  summarize(count=n())
```

Some raw data
links to column names https://fastballs.wordpress.com/category/pitchfx-glossary/

pfx_x: the horizontal movement, in inches, of the pitch between the release point and home plate, as compared to a theoretical pitch thrown at the same speed with no spin-induced movement. This parameter is measured at y=40 feet regardless of the y0 value.

pfx_z: the vertical movement, in inches, of the pitch between the release point and home plate, as compared to a theoretical pitch thrown at the same speed with no spin-induced movement. This parameter is measured at y=40 feet regardless of the y0 value.

plate_x: the left/right distance, in feet, of the pitch from the middle of the plate as it crossed home plate. The PITCHf/x coordinate system is oriented to the catcher’s/umpire’s perspective, with distances to the right being positive and to the left being negative.

plate_z: the height of the pitch in feet as it crossed the front of home plate.


```{r at bats}
mookie_bat_data <- mookie_data %>%
  select(events, pitch_name, release_speed, pitcher, bb_type, pfx_x, pfx_z, plate_x, plate_z, launch_angle, launch_speed, hit_distance_sc, sz_top, sz_bot)
mookie_bat_data %>%
  filter(events=="home_run") %>%
  head()
```

Before we can analyze and graph this we need to clean it up.
```{R cleaning}
mookie_bat_data <- mookie_bat_data %>%
  type_convert(cols(release_speed=col_double(), pfx_x=col_double(), pfx_z=col_double(), plate_x=col_double(), plate_z=col_double(), launch_angle=col_double(), launch_speed=col_double(), hit_distance_sc=col_integer(), sz_top=col_double(), sz_bot=col_double()))

mookie_bat_data$pitch_name <- as.factor(mookie_bat_data$pitch_name)
mookie_bat_data$events <- as.factor(mookie_bat_data$events)
mookie_bat_data$bb_type <- as.factor(mookie_bat_data$bb_type)
head(mookie_bat_data)
```
```{r graphing}
strike_zone_top <- mean(mookie_bat_data$sz_top, na.rm=TRUE)
strike_zone_bot <- mean(mookie_bat_data$sz_bot, na.rm=TRUE)
strike_zone_front <- 17/2.0/12


graphed <- ggplot() + geom_rect(aes(xmin=-strike_zone_front, xmax=strike_zone_front, ymin=strike_zone_bot, ymax=strike_zone_top), color="black", fill=NA) + geom_point(data=mookie_bat_data, aes(x=plate_x, y=plate_z, text=sprintf("events: %s<br>Pitch Name: %s<br>Release Speed: %s<br>Launch Angle: %s", events, pitch_name, release_speed, launch_angle))) +
  scale_x_continuous(name="Catchers View | left/right distance in feet of center of plat", limits=c(-4, 4), breaks=seq(from=-4, to=4, by=2)) + scale_y_continuous(name="Height above plate In Feet", limits=c(-2, 6), breaks=seq(from=-2, to=6, by=1))

ggplotly(graphed) 
```
This is rather ugly. Lets do pitches that result in action and color code it by the event that happens.
```{r hits}
action <- mookie_bat_data %>%
  filter(events!="null")

graphed <- ggplot() + geom_rect(aes(xmin=-strike_zone_front, xmax=strike_zone_front, ymin=strike_zone_bot, ymax=strike_zone_top), color="black", fill=NA) + geom_point(data=action, aes(x=plate_x, y=plate_z, text=sprintf("events: %s<br>Pitch Name: %s<br>Release Speed: %s<br>Launch Angle: %s", events, pitch_name, release_speed, launch_angle), color=events)) +
  scale_x_continuous(name="Catchers View | left/right distance in feet of center of plat", limits=c(-4, 4), breaks=seq(from=-4, to=4, by=2)) + scale_y_continuous(name="Height above plate In Feet", limits=c(-2, 6), breaks=seq(from=-2, to=6, by=1))

ggplotly(graphed) 
```
